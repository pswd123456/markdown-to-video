{"id": "task-001", "type": "feat", "intent": "Initial project setup", "changes": [{"file": ".gitignore", "action": "create", "symbols": []}, {"file": "README.md", "action": "create", "symbols": []}, {"file": "poetry.lock", "action": "create", "symbols": []}, {"file": "pyproject.toml", "action": "create", "symbols": []}, {"file": "src/__init__.py", "action": "create", "symbols": []}, {"file": "src/components/__init__.py", "action": "create", "symbols": []}, {"file": "src/core/__init__.py", "action": "create", "symbols": []}, {"file": "src/core/config.py", "action": "create", "symbols": ["Settings"]}, {"file": "src/core/models.py", "action": "create", "symbols": ["ErrorType", "SceneSpec", "CodeGenerationRequest", "LintResult", "CritiqueFeedback", "RenderArtifact"]}, {"file": "src/llm/__init__.py", "action": "create", "symbols": []}, {"file": "src/utils/__init__.py", "action": "create", "symbols": []}, {"file": "tests/__init__.py", "action": "create", "symbols": []}, {"file": "tests/test_phase1_infrastructure.py", "action": "create", "symbols": ["test_infrastructure"]}], "summary": "Initial project structure and poetry dependencies."}
{"id": "task-002", "type": "feat", "intent": "Implement CodeLinter and dry-run logic", "changes": [{"file": "src/components/linter.py", "action": "create", "symbols": ["CodeLinter"]}, {"file": "src/utils/code_ops.py", "action": "create", "symbols": ["extract_code"]}, {"file": "tests/test_phase2_linter.py", "action": "create", "symbols": ["test_linter"]}], "summary": "Added AST syntax check and Manim dry-run validation."}
{"id": "task-003", "type": "feat", "intent": "Implement Docker-based Manim renderer", "changes": [{"file": "Dockerfile", "action": "create", "symbols": []}, {"file": "src/components/renderer.py", "action": "create", "symbols": ["ManimRunner", "RenderError"]}, {"file": "tests/test_phase3_renderer.py", "action": "create", "symbols": ["test_renderer"]}], "summary": "Added Dockerfile and ManimRunner class for secure rendering."}
{"id": "task-004", "type": "feat", "intent": "Implement LangGraph workflow for Manim video generation", "changes": [{"file": "poetry.lock", "action": "modify", "symbols": []}, {"file": "pyproject.toml", "action": "modify", "symbols": []}, {"file": "src/components/linter.py", "action": "modify", "symbols": ["CodeLinter._dry_run"]}, {"file": "src/components/renderer.py", "action": "modify", "symbols": ["ManimRunner.render"]}, {"file": "src/components/context_builder.py", "action": "create", "symbols": ["ContextBuilder"]}, {"file": "src/core/graph.py", "action": "create", "symbols": ["ManimGraph"]}, {"file": "src/core/state.py", "action": "create", "symbols": ["GraphState"]}, {"file": "src/llm/client.py", "action": "create", "symbols": ["LLMClient"]}, {"file": "src/main_graph.py", "action": "create", "symbols": ["main"]}], "summary": "Integrated LangGraph to orchestrate code generation, linting, and Docker rendering for Manim videos. Added LLM client, context builder, and state management. Improved linter and renderer robustness."}
{"id": "task-005", "type": "feat", "intent": "Integrate Vision Critic and refine LangGraph workflow with visual feedback", "changes": [{"file": ".gitignore", "action": "modify", "symbols": []}, {"file": "poetry.lock", "action": "modify", "symbols": []}, {"file": "pyproject.toml", "action": "modify", "symbols": []}, {"file": "src/components/critic.py", "action": "create", "symbols": ["VisionCritic"]}, {"file": "src/core/graph.py", "action": "modify", "symbols": ["ManimGraph", "ManimGraph.node_generate_code", "ManimGraph.node_check_syntax", "ManimGraph.node_render", "ManimGraph.node_critic", "ManimGraph.node_prep_syntax_retry", "ManimGraph.node_prep_visual_retry", "ManimGraph.edge_router_after_lint", "ManimGraph.edge_router_after_render", "ManimGraph.edge_router_after_critic", "ManimGraph.compile"]}, {"file": "src/core/state.py", "action": "modify", "symbols": ["GraphState"]}, {"file": "src/main_graph.py", "action": "modify", "symbols": ["main"]}], "summary": "Implemented a Vision Critic using LLM for visual QA of rendered Manim outputs. Integrated it into the LangGraph workflow, adding visual feedback to the code generation loop and separate retry mechanisms for syntax and visual errors. Updated dependencies and .gitignore."}
{"id": "task-006", "type": "feat", "intent": "Implement full video generation pipeline with TTS, assembler, and main orchestrator", "changes": [{"file": "poetry.lock", "action": "modify", "symbols": []}, {"file": "pyproject.toml", "action": "modify", "symbols": []}, {"file": "src/components/critic.py", "action": "modify", "symbols": ["VisionCritic.review_layout"]}, {"file": "src/components/renderer.py", "action": "modify", "symbols": ["ManimRunner.render"]}, {"file": "src/core/graph.py", "action": "modify", "symbols": ["ManimGraph"]}, {"file": "src/main_graph.py", "action": "delete", "symbols": []}, {"file": "script_demo.json", "action": "create", "symbols": []}, {"file": "src/components/assembler.py", "action": "create", "symbols": ["Assembler"]}, {"file": "src/components/tts.py", "action": "create", "symbols": ["TTSEngine"]}, {"file": "src/main.py", "action": "create", "symbols": ["load_script", "main"]}, {"file": "src/utils/logger.py", "action": "create", "symbols": ["logger", "MetricsTracker", "metrics"]}], "summary": "Implemented the complete video generation pipeline. Added Text-to-Speech (TTS) for audio narration, an Assembler component for stitching video and audio, and a new main orchestrator script. Refined the visual critic by ensuring proper frame extraction. Introduced logging and metrics tracking. Updated dependencies to include TTS-related libraries."}
{"id": "task-007", "type": "refactor", "intent": "Migrate TTS engine from Edge-TTS to DashScope (Qwen-TTS)", "changes": [{"file": "poetry.lock", "action": "modify", "symbols": []}, {"file": "pyproject.toml", "action": "modify", "symbols": []}, {"file": "src/components/tts.py", "action": "modify", "symbols": ["TTSEngine"]}], "summary": "Replaced Edge-TTS with DashScope's Qwen-TTS model (qwen3-tts-flash) for higher quality speech synthesis. Updated dependencies by removing edge-tts and adding dashscope."}{"id": "task-fix-tts-01", "type": "fix", "intent": "Fix DashScope TTS 'get_audio_data' exception by using correct response attributes", "changes": [{"file": "src/components/tts.py", "action": "modify", "symbols": ["TTSEngine.generate"]}], "summary": "Replaced non-existent get_audio_data() call with status code check and result.output.audio.url/data access."}
{"id": "task-008", "type": "fix", "intent": "Fixing the problem of tts not working", "changes": [{"file": "src/components/tts.py", "action": "modify", "symbols": ["TTSEngine.generate"]}, {"file": "tests/test_components_tts.py", "action": "create", "symbols": []}], "summary": "Fixed TTS generation by updating DashScope API call to use MultiModalConversation and correctly parsing the response for audio URL."}
{"id": "task-009", "type": "perf", "intent": "Optimize graph sequence to skip redundant visual critique after max retries", "changes": [{"file": "src/core/graph.py", "action": "modify", "symbols": ["ManimGraph.edge_router_after_render", "ManimGraph.compile"]}], "summary": "Modified graph routing to skip VisionCritic call when visual retry limit is reached, reducing API costs."}
{"id": "task-010", "type": "docs", "intent": "Update README to reflect current project functionality", "changes": [{"file": "README.md", "action": "modify", "symbols": []}], "summary": "Updated README.md with project description, features, installation, usage, and input format."}
{"id": "task-011", "type": "feat", "intent": "Implement script rewriting and architectural updates", "changes": [{"file": ".gitignore", "action": "modify", "symbols": []}, {"file": "development_assets/项目架构.md", "action": "create", "symbols": []}, {"file": "poetry.lock", "action": "modify", "symbols": []}, {"file": "pyproject.toml", "action": "modify", "symbols": []}, {"file": "src/components/__init__.py", "action": "modify", "symbols": ["ScriptRewriter"]}, {"file": "src/components/critic.py", "action": "modify", "symbols": []}, {"file": "src/components/linter.py", "action": "modify", "symbols": []}, {"file": "src/components/renderer.py", "action": "modify", "symbols": []}, {"file": "src/components/rewriter.py", "action": "create", "symbols": ["ScriptRewriter"]}, {"file": "src/components/tts.py", "action": "modify", "symbols": []}, {"file": "src/core/graph.py", "action": "modify", "symbols": ["node_check_syntax", "node_render", "node_critic"]}, {"file": "src/core/models.py", "action": "modify", "symbols": []}, {"file": "src/llm/client.py", "action": "modify", "symbols": ["LLMClient"]}, {"file": "src/main.py", "action": "modify", "symbols": []}, {"file": "src/utils/logger.py", "action": "modify", "symbols": []}, {"file": "tests/test_components_tts.py", "action": "modify", "symbols": []}, {"file": "tests/test_graph_optimization.py", "action": "modify", "symbols": []}, {"file": "tests/test_phase1_infrastructure.py", "action": "modify", "symbols": []}, {"file": "tests/test_phase2_linter.py", "action": "modify", "symbols": []}], "summary": "Implemented ScriptRewriter component, updated core models, graph, and linter, and added architectural documentation."}
{"id": "task-012", "type": "fix", "intent": "Fix test_visual_retry_optimization failure", "changes": [{"file": "tests/test_graph_optimization.py", "action": "modify", "symbols": []}], "summary": "Fixed test_visual_retry_optimization by invoking the compiled graph."}
{"id": "task-013", "type": "feat", "intent": "Improve script rewriter with structured JSON output and retry logic", "changes": [{"file": "src/components/rewriter.py", "action": "modify", "symbols": ["ScriptRewriter.rewrite"]}, {"file": "src/llm/prompts.py", "action": "create", "symbols": ["STORYBOARD_SYSTEM_PROMPT"]}, {"file": "src/utils/code_ops.py", "action": "modify", "symbols": ["extract_json"]}, {"file": "tests/test_rewriter_mock.py", "action": "create", "symbols": ["TestRewriterMock"]}], "summary": "Implemented structured JSON output for script rewriter, added retry logic, and introduced prompt management."}
{"id": "task-014", "type": "feat", "intent": "Add Pydantic validation to script rewriter", "changes": [{"file": "src/components/rewriter.py", "action": "modify", "symbols": ["ScriptRewriter.rewrite"]}, {"file": "tests/test_rewriter_validation.py", "action": "create", "symbols": ["test_validation_success", "test_validation_failure_missing_field_then_success", "test_validation_failure_wrong_type_exhaust_retries"]}], "summary": "Integrated Pydantic SceneSpec for validating LLM output in ScriptRewriter."}
{"id": "task-015", "type": "feat", "intent": "Integrate ScriptRewriter into main pipeline", "changes": [{"file": "src/main.py", "action": "modify", "symbols": ["load_script", "main"]}, {"file": "tests/test_main_integration.py", "action": "create", "symbols": ["test_load_script_json", "test_load_script_md_integration", "test_load_script_unsupported"]}], "summary": "Modified main.py to support .md/.txt inputs by invoking ScriptRewriter, enabling end-to-end processing from raw text to video."}
{"id": "task-016", "type": "feat", "intent": "Add SceneType enum and type field to SceneSpec", "changes": [{"file": "src/core/models.py", "action": "modify", "symbols": ["SceneSpec", "SceneType"]}, {"file": "src/llm/prompts.py", "action": "modify", "symbols": ["STORYBOARD_SYSTEM_PROMPT"]}, {"file": "tests/test_rewriter_validation.py", "action": "modify", "symbols": ["test_validation_success"]}], "summary": "Introduced SceneType enum and added type field to SceneSpec for routing logic."}
{"id": "task-017", "type": "fix", "intent": "Fix audio cut-off by syncing scene duration with generated audio", "changes": [{"file": "src/components/tts.py", "action": "modify", "symbols": ["TTSEngine.get_duration"]}, {"file": "src/main.py", "action": "modify", "symbols": ["main"]}, {"file": "tests/test_components_tts.py", "action": "modify", "symbols": ["TestTTSEngine"]}], "summary": "Implemented audio duration calculation using ffprobe and updated scene duration to match audio length + buffer."}
{"id": "task-018", "type": "feat", "intent": "Add 1s black screen spacer between video segments for natural transition", "changes": [{"file": "src/components/assembler.py", "action": "modify", "symbols": ["Assembler.assemble", "Assembler._get_video_resolution", "Assembler._create_spacer"]}, {"file": "tests/test_components_assembler.py", "action": "create", "symbols": ["TestAssembler"]}], "summary": "Implemented logic to generate a 1s black spacer video matching the resolution of the first segment and insert it between segments during assembly."}
{"id": "task-019", "type": "fix", "intent": "Fix garbled Chinese characters in video rendering by enforcing Noto Sans CJK SC font", "changes": [{"file": "src/components/context_builder.py", "action": "modify", "symbols": ["ContextBuilder.build_system_prompt"]}, {"file": "lib/api_stubs.txt", "action": "modify", "symbols": ["Text"]}, {"file": "lib/examples.txt", "action": "modify", "symbols": ["Example 3"]}], "summary": "Updated system prompt, API stubs, and examples to strictly enforce usage of font=\"Noto Sans CJK SC\" for all Text objects."}
{"id": "task-020", "type": "feat", "intent": "Enforce Intro/Summary scenes in storyboard and save rewrite output", "changes": [{"file": "src/llm/prompts.py", "action": "modify", "symbols": ["STORYBOARD_SYSTEM_PROMPT"]}, {"file": "src/main.py", "action": "modify", "symbols": ["load_script"]}, {"file": "tests/test_rewriter_mock.py", "action": "modify", "symbols": ["test_rewrite_prompt_content"]}, {"file": "tests/test_main_save_storyboard.py", "action": "create", "symbols": ["test_load_script_saves_storyboard"]}], "summary": "Updated system prompt to require Intro/Summary scenes and modified main loop to save the generated storyboard JSON to disk."}
{"id": "task-021", "type": "feat", "intent": "Enforce Chinese output and 60s total duration in storyboard rewrite prompt", "changes": [{"file": "src/llm/prompts.py", "action": "modify", "symbols": ["STORYBOARD_SYSTEM_PROMPT"]}, {"file": "tests/test_rewriter_mock.py", "action": "modify", "symbols": ["test_rewrite_prompt_content"]}], "summary": "Updated STOYBOARD_SYSTEM_PROMPT to explicitly require audio_script to be in Chinese and total duration to be approximately 60 seconds."}
{"id": "task-022", "type": "chore", "intent": "Verify Noto Sans CJK SC font availability in Manim Docker container", "changes": [], "summary": "Confirmed Noto Sans CJK SC font is correctly installed and discoverable by fc-list within the Manim Docker container."}
{"id": "task-023", "type": "fix", "intent": "Add detailed logger information to debug scene failure", "changes": [{"file": "src/main.py", "action": "modify", "symbols": ["main"]}], "summary": "Added debug logs for error_log, critic_feedback, and retry stats when a scene fails."}
{"id": "task-024", "type": "fix", "intent": "Fix Docker user configuration to use existing manimuser", "changes": [{"file": "Dockerfile", "action": "modify", "symbols": []}], "summary": "Updated Dockerfile to use manimuser instead of trying to create a new manim user, fixing build and runtime errors."}
{"id": "task-025", "type": "refactor", "intent": "Move prompt strings from components to src/llm/prompts.py for centralization", "changes": [{"file": "src/llm/prompts.py", "action": "modify", "symbols": ["STORYBOARD_SYSTEM_PROMPT", "CRITIC_SYSTEM_PROMPT", "build_code_system_prompt", "build_code_user_prompt", "build_critic_user_prompt"]}, {"file": "src/components/context_builder.py", "action": "modify", "symbols": ["ContextBuilder.build_system_prompt", "ContextBuilder.build_user_prompt"]}, {"file": "src/components/critic.py", "action": "modify", "symbols": ["VisionCritic.review_layout"]}], "summary": "Centralized all LLM prompt definitions in src/llm/prompts.py for better organization and maintainability."}
{"id": "task-026", "type": "feat", "intent": "Save erroneous code to output/debug/ when Critic fails", "changes": [{"file": "src/core/graph.py", "action": "modify", "symbols": ["ManimGraph.node_critic"]}, {"file": "tests/test_critic_debug_save.py", "action": "create", "symbols": ["test_node_critic_saves_debug_code"]}], "summary": "Implemented logic in ManimGraph.node_critic to save the generated code to output/debug/ when the Vision Critic returns a failure status."}
{"id": "task-027", "type": "fix", "intent": "Loosen critic constraints and fix layout overlapping", "changes": [{"file": "lib/examples.txt", "action": "modify", "symbols": []}, {"file": "src/core/graph.py", "action": "modify", "symbols": ["node_critic", "edge_router_after_critic"]}, {"file": "src/llm/prompts.py", "action": "modify", "symbols": ["CRITIC_SYSTEM_PROMPT"]}], "summary": "Updated critic prompt to focus on fatal errors, added score check to graph router, and added defensive layout example."}
{"id": "task-028", "type": "feat", "intent": "Add Planner node to ManimGraph for layout planning", "changes": [{"file": "src/llm/client.py", "action": "modify", "symbols": ["generate_text"]}, {"file": "src/core/graph.py", "action": "modify", "symbols": ["ManimGraph", "node_plan_layout", "node_generate_code", "compile"]}], "summary": "Implemented Planner node to generate layout plans before code generation, updated graph workflow to route through planner."}
{"id": "task-029", "type": "feat", "intent": "Save planner node output to output/plan", "changes": [{"file": "src/core/graph.py", "action": "modify", "symbols": ["node_plan_layout"]}], "summary": "Modified node_plan_layout to save the generated plan to a file in output/plan/."}
{"id": "task-030", "type": "feat", "intent": "Save retried screenshots with suffix to output/picture", "changes": [{"file": "src/components/renderer.py", "action": "modify", "symbols": ["ManimRunner.render"]}, {"file": "src/core/graph.py", "action": "modify", "symbols": ["node_render"]}], "summary": "Updated ManimRunner to save images to output/picture/ and modified Graph to append retry suffix to scene_id during visual retries."}
{"id": "task-031", "type": "refactor", "intent": "Organize video output into subdirectories", "changes": [{"file": "src/components/renderer.py", "action": "modify", "symbols": ["ManimRunner.render"]}, {"file": "src/components/assembler.py", "action": "modify", "symbols": ["Assembler.assemble"]}], "summary": "Redirected raw video clips to output/raw_video_clips and assembled segments to output/segments."}
{"id": "task-032", "type": "refactor", "intent": "Refactor Graph with Fixer node and improved retry logic", "changes": [{"file": "src/core/graph.py", "action": "modify", "symbols": ["ManimGraph", "node_analyze_error"]}, {"file": "src/core/state.py", "action": "modify", "symbols": ["GraphState"]}, {"file": "src/llm/prompts.py", "action": "modify", "symbols": ["build_fixer_system_prompt", "build_code_user_prompt"]}, {"file": "tests/test_fix_plan_output.py", "action": "create", "symbols": []}], "summary": "Introduced a dedicated Fixer node to handle error analysis and fix strategies, updated prompts, and added tests."}
{"id": "task-033", "type": "feat", "intent": "Add file saving for planner node", "changes": [{"file": "src/core/graph.py", "action": "modify", "symbols": ["node_plan_layout"]}, {"file": "src/llm/prompts.py", "action": "modify", "symbols": []}, {"file": "src/core/config.py", "action": "modify", "symbols": []}], "summary": "Implemented file saving for the planner node output and fixed various test/lint issues."}
{"id": "task-034", "type": "docs", "intent": "Update README and add Chinese documentation", "changes": [{"file": "README.md", "action": "modify", "symbols": []}, {"file": "assets/README_cn.md", "action": "create", "symbols": []}], "summary": "Updated English README to reflect current architecture and created Chinese version in assets folder."}
{"id": "task-035", "type": "refactor", "intent": "Refactor core graph execution and main application flow", "changes": [{"file": "src/core/graph.py", "action": "modify", "symbols": ["Graph", "Execution"]}, {"file": "src/main.py", "action": "modify", "symbols": ["main"]}, {"file": "src/components/renderer.py", "action": "modify", "symbols": []}], "summary": "Major refactor of graph execution logic and main entry point, updating renderer and tests."}
{"id": "task-036", "type": "feat", "intent": "Update LLM prompts and examples for improved generation", "changes": [{"file": "src/llm/prompts.py", "action": "modify", "symbols": []}, {"file": "lib/examples.txt", "action": "modify", "symbols": []}, {"file": "src/core/graph.py", "action": "modify", "symbols": []}, {"file": "src/main.py", "action": "modify", "symbols": []}], "summary": "Updated src/llm/prompts.py and lib/examples.txt to refine LLM prompt generation and provide new examples. Minor adjustments in src/core/graph.py and src/main.py."}
{"id": "task-037", "type": "refactor", "intent": "Clean up assets and refine LLM prompts", "changes": [{"file": "assets.md", "action": "modify", "symbols": []}, {"file": "lib/examples.txt", "action": "modify", "symbols": []}, {"file": "script_demo.json", "action": "delete", "symbols": []}, {"file": "src/llm/prompts.py", "action": "modify", "symbols": []}], "summary": "Removed unused script_demo.json, cleaned up assets.md and examples.txt, and further refined LLM prompts."}
{"id": "task-038", "type": "docs", "intent": "Rewrite README to reflect v3.0 architecture and deployment steps", "changes": [{"file": "README.md", "action": "modify", "symbols": []}], "summary": "Updated README.md to reflect the current parallel architecture, multi-agent workflow, and deployment instructions including Docker and .env configuration."}
